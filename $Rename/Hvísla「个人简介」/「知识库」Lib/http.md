# http

# https
> 背景: http内容是明文传输，中间会经过中间代理服务器、路由器、wifi热点、通信服务运营商等多个物理节点，如果在这中间的传输过程被劫持的话那这里传输的内容就完全暴露了。

## 对称加密
指加密和解密都是同一个密钥。

## 非对称加密
指加密和解密不是同一个密钥。   
其中公钥进行加密且可以公开,并给别人进行加密；私钥解密，私钥永远在自己手上。

### 非对称加密 + 对称加密
使用两组非对称加密会导致算法非常耗时，所以用非对称加密和对称加密结合来减少非对称加密的次数。
1. 某网站拥有用于非对称加密的公钥A、私钥A'
2. 浏览器向网站服务器请求，服务器把公钥A明文传输到浏览器
3. 浏览器随机生成一个用于对称加密的密钥X，用公钥A加密后传输给服务器
4. 服务器拿到后用私钥A'解密得到密钥X
5. 这样双方都能拥有密钥X，之后双方所有数据都通过密钥X加密解密即可
*但是这里还是有个漏洞*，如果在数据传输过程中，中间人劫持到了数据，此时他的确无法得到浏览器生成的密钥X，这个密钥本身被公钥A加密了，但是只有浏览器才有私钥A'可以解密，然而中间人却不需要拿到私钥A'就能进行破坏。
1. 某网站有用于非对称加密的公钥A、私钥A'
2. 浏览器向网站服务器请求，服务器把公钥A明文传输给浏览器
3. **中间人劫持到公钥A，保存下来，并把数据包中的公钥A替换成自己伪造的公钥B(当然同时也拥有公钥B对应的私钥B')**
4. 浏览器生成一个用于对称加密的密钥X，用公钥B加密后传回服务器(浏览器无法得知公钥被替换)
5. **中间人劫持后用私钥B'解密得到密钥X，再用公钥A加密后传给服务器**
6. 服务器拿到私钥A'解密得到密钥X
> 该问题发生的根本原因是：浏览器无法确认收到的公钥是不是网站自己的
为了保证浏览器收到的公钥匙网站的公钥，CA机构颁发数字证书来解决。
### 数字证书
网站在使用HTTPS之前，需要向CA机构申领一份数字证书，证书中包含持有者信息，公钥信息等。服务器把证书传输给浏览器，浏览器从证书中获取公钥即可，证书就如身份证，证明该公钥对应该网站。   
那同时又如何防止数字证书被篡改？
> 我们把证书原本的内容生成一份"数字签名"，比对证书内容和签名是否一致就能判断是否被篡改。

#### 制作工程
1. CA机构拥有非对称加密的私钥和公钥
2. CA机构对证书明文T进行hast
3. 对hash后的值进行私钥加密，得到数字签名S

即明文和数字签名组成了数字证书，这样就可以将数字证书颁发给网站。
同时浏览器拿到服务器传过来的数字证书之后也要校验是否被出篡改或者调包。
1. 拿到证书，得到明文T、签名S
2. 用CA机构的公钥对S解密(由于是浏览器信任的机构，所以浏览器)