# CDN
Content Delivery Network，目的是为源站减少访问压力的同时，为客户端提供更加快速的内容响应。

## 好处
1. 缩短网站加载时间
通过将内容分发到访问者附近的CDN服务器，访问者体验更快访问到页面。
2. 增加内容可用性和冗余
大流量或硬件故障可能回扰乱正常的网站功能，由于CDN具有分布式特性，因此与许多源服务器相比，CDN可以更好处理更多流量并更好地承受硬件故障。
3. 改善网站安全性
CDN可以通过提供DDos缓解、安全证书的改进以及其他优化措施来提高安全性。

## DNS
想要了解CDN的工作原理，就要掌握一定的DNS知识。
> DNS的协议主要基于UDP

### DNS记录类型
- A
记录域名到ipv4地址
- AAAA
记录域名到ipv6地址
- CNAME
记录类似查询过程中的转发

### DNS工作过程
假设访问`www.taobao.com`，经过以下几个过程：
1. 输入`www.taobao.com`，实际dns协议使用的是`www.taobao.com.`
2. 查询本地缓存(host文件或者浏览器缓存)
3. 向运营商的DNS服务器发起dns解析请求，一般称运营商的DNS服务器为local dns
4. local dns会查询本地缓存
5. local dns如果没有缓存会将域名从右往左扫描，以此请求对应服务器。
  - 向负责`.`的根域名服务器，先答复`.com`是谁管理的，然后`local dns`去找管理`.com`的服务器(假设服务器为S1)询问`taobao.com`是谁管理。一般来说在S1查到的记录是一条CNAME记录，然后就跳转到阿里自己的DNS服务器上(阿里自己管理旗下的域名)，一般称为权威服务器。
6. 权威服务器是阿里自己搭建，根据自己公司的配置、调整，可以查到`www.taobao.com.`对应的服务器是谁，并返回一个IP地址
7. local dns缓存这个地址并回复浏览器
8. 浏览器和对应的IP地址服务器建立TCP链接，发送HTT报文


## CDN工作过程
以微博为例：  
假设微博使用了阿里的CDN，阿里CDN会告诉微博如果需要加速一张图片，则需要将图片解析到阿里的服务器(可以是CNAME，也可以直接写阿里CDN的url)。 
接着阿里CDN的dns权威服务器就会收到一个解析请求——`微博的1.png的源站在哪？`这时候阿里CDN的dns权威服务器就会看请求者的IP是多少，判断地区在哪，在广州则返回广州的源站，实现就近访问。


# 参考
[CDN原理简析](https://www.yuque.com/vesper/doc/ui0mcq)